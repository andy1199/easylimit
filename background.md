# 开发背景 #

前几年，那个时候的大部分系统都采用的是“**服务端业务处理 + 前端页面模板**”的项目开发模式，因此这种系统的权限控制比较好处理，可以通过后端校验权限，并在权限校验没有通过的情况下控制前端页面跳转到登录页面或者错误页面。

目前这种项目开发模式的权限控制已经有比较成熟的方案——**cookie-session认证机制**，在`Java Web`项目中其主流解决方案是使用`Spring Security`或者`Shiro`等框架完成系统的权限控制。

但是，最近这几年**前后端分离项目开发模式**开始逐渐兴起，其目的是为了解决前端和服务端耦合性太强的问题，方便前端页面可以随时更改，独立运行。此外，APP、微信公众号、小程序也可以看做是前后端分离项目模式的“前端”，因为核心业务逻辑仍然是在服务端处理，APP、微信公众号、小程序则主要进行数据展示。

在前后端分离项目开发模式中，后端不再拥有对前端页面的控制权，而这恰恰引起了以下几个新的问题。

其一，当后端判断用户没有登录或者权限不够时无法控制前端页面跳转到登录页面/未授权页面；其二，在`MVC`项目开发模式中，每当前端页面请求后端都会携带当前用户的`session_id`，以便后端可以在`SessionDAO`中刷新用户会话，保持在线状态，但是在前后端分离项目开发模式中，前端页面（注：这里泛指浏览器、APP等数据展示端）可能很长时间才会请求一次后端接口（注：比如用户每隔几小时甚至几天才打开一次APP），这种现象导致后端无法让用户会话一直处于**活动状态**，而且即使花费大量内存代价人为延长用户会话的时效时间，其做法也显得极其低效；其三，以往`MVC`项目开发模式中成熟的`cookie-session认证机制`严重依赖于浏览器的`cookie`机制，在APP等没有cookie的环境中将完全没法使用。

因为上述所说的这几个问题，所以导致在前后端分离项目开发模式中只能抛弃传统的`cookie-session认证机制`，重新寻找新的权限控制方式。目前在`Java Web`项目中使用特别广泛的解决方案主要是：`JSON Web Token (JWT) `。

所谓`JWT`，本质上是一种特殊格式的字符串（`token`），然后主要通过以下两个步骤实现权限控制：

1. 用户登录成功后，服务端给客户端返回一个JSON格式的令牌（token），即：`JSON Web Token (JWT)`。JWT通常由三部分组成: **头信息（header）**，**消息体（payload）**和**签名（signature）** 。头信息指定了该JWT使用的签名算法；消息体包含了JWT的意图，比如令牌的过期时间，用户主体信息等内容；最后签名则主要是为了确保消息数据不被篡改。
2. 客户端接收服务端返回的JWT，将其存储在`cookie`、`LocalStorage`等其他客户端存储方案中，此后客户端将在与服务端交互中都会带上JWT。然后服务端在接收到`JWT`后再验证其是否合法，以及JWT中的权限信息是否被允许访问当前资源。

从JWT的实现原理我们可以看出，JWT解决了一部分前后端分离项目开发模式引发的问题，但是它并没有完全解决，而且JWT在管理用户权限方面至少还存在以下几个方面的缺点：

1. **更多的空间占用**。使用JWT后服务器不再保存会话状态，因此如果将服务端原有session中的各类信息都放在JWT中保存到客户端，可能造成JWT占用的空间太大问题；
2. **无法作废已颁发的令牌**。所有的认证信息都放在JWT中（注：JWT在客户端存储），再加之在服务端不再保存会话状态，因此即使你知道某个JWT被盗取了也无法立即将其作废；
3. **无法应对权限信息更新或者过期的问题**。与上一条类似，在JWT中保存的用户权限信息如果在JWT令牌过期之前发生了更改，那么你除了忍受“过期”数据别无办法。

因此，在现如今WEB开发逐渐倾向于前后端分离、分布式等现实背景下，一种实现方式简单、功能完整、运行效率高且可以避免JWT的诸多缺点的权限控制模型及现成可用的框架已经成为一个亟待解决的问题。